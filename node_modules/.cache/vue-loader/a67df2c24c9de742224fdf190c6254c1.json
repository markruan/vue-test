{"remainingRequest":"/Users/mc/项目/VUE/2020/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mc/项目/VUE/2020/src/components/audio-player.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"/Users/mc/项目/VUE/2020/src/components/audio-player.vue","mtime":1602756715739},{"path":"/Users/mc/项目/VUE/2020/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/mc/项目/VUE/2020/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/mc/项目/VUE/2020/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/mc/项目/VUE/2020/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mc/项目/VUE/2020/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.audio-player {\n  margin: 0 15px;\n}\n\n.audio-player .audio__btn-wrap {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.audio-player .audio__btn-wrap .audio__play__icon {\n  width: 100%;\n  height: 100%;\n  fill: currentColor;\n  overflow: hidden;\n  color: #e35924;\n}\n\n.audio-player .audio__btn-wrap .audio__play--previous {\n  font-size: 33px;\n  width: 21px;\n  height: 33px;\n}\n\n.audio-player .audio__btn-wrap .audio__play--previous.disable {\n  opacity: 0.5;\n}\n\n.audio-player .audio__btn-wrap .audio__play--start {\n  font-size: 42px;\n  width: 42px;\n  height: 42px;\n  margin: 0 30px 0 40px;\n}\n\n.audio-player .audio__btn-wrap .audio__play--pause {\n  font-size: 42px;\n  width: 42px;\n  height: 42px;\n  margin: 0 30px 0 40px;\n}\n\n.audio-player .audio__btn-wrap .audio__play--next {\n  font-size: 33px;\n  width: 21px;\n  height: 33px;\n}\n\n.audio-player .audio__btn-wrap .audio__play--next.disable {\n  opacity: 0.5;\n}\n\n.audio-player .audio__progress-wrap {\n  position: relative;\n  background: #ddd;\n  height: 2px;\n  margin-top: 20px;\n}\n\n.audio-player .audio__progress-wrap .audio__progress {\n  position: absolute;\n  left: 0;\n  top: 0;\n  bottom: 0;\n  width: 0;\n  background: #e35924;\n}\n\n.audio-player .audio__progress-wrap .audio__progress-point {\n  position: absolute;\n  left: 0;\n  top: 50%;\n  width: 16px;\n  height: 16px;\n  border-radius: 50%;\n  margin-top: -8px;\n  background: #e35924;\n  box-shadow: 0 0 10px 1px rgba(227, 89, 36, 0.5);\n}\n\n.audio-player .audio__progress-wrap .audio__progress-point:after {\n  content: \"\";\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 8px;\n  height: 8px;\n  margin: -4px 0 0 -4px;\n  background: #fff;\n  border-radius: 50%;\n}\n\n.audio-player .audio__time-wrap {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  margin-top: 7px;\n}\n\n.audio-player .audio__time-wrap .audio__current-time {\n  font-size: 10px;\n  color: #888;\n}\n\n.audio-player .audio__time-wrap .audio__duration {\n  font-size: 10px;\n  color: #888;\n}\n\n.audio-player .audio-player__audio {\n  display: block;\n  margin: 0 auto;\n}\n",{"version":3,"sources":["audio-player.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8YA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"audio-player.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"audio-player\">\n    <div class=\"audio__btn-wrap\">\n      <div\n        v-show=\"showPrevButton\"\n        class=\"audio__play--previous\"\n        :class=\"{ disable: !isLoop && currentPlayIndex === 0 }\"\n        @click=\"playPrev\"\n      >\n        <van-icon name=\"arrow-left\" />\n      </div>\n\n      <div v-if=\"!isPlaying && showPlayButton\" @click=\"play\" class=\"audio__play--start\">\n        <van-icon name=\"play-circle-o\" />\n      </div>\n\n      <div v-else-if=\"showPlayButton\" @click=\"pause\" class=\"audio__play--pause\">\n        <van-icon name=\"pause-circle-o\" />\n      </div>\n\n      <div\n        v-show=\"showNextButton\"\n        class=\"audio__play--next\"\n        :class=\"{ disable: !isLoop && currentPlayIndex === audioList.length - 1 }\"\n        @click=\"playNext\"\n      >\n        <van-icon name=\"arrow\" />\n      </div>\n    </div>\n\n    <div\n      v-show=\"showProgressBar\"\n      class=\"audio__progress-wrap\"\n      ref=\"audioProgressWrap\"\n      @click=\"initProgressBarPoint\"\n    >\n      <div class=\"audio__progress\" ref=\"audioProgress\" />\n      <div class=\"audio__progress-point\" ref=\"audioProgressPoint\" />\n    </div>\n\n    <div v-show=\"showProgressBar\" class=\"audio__time-wrap\">\n      <div class=\"audio__current-time\">{{ currentTimeAfterFormat }}</div>\n      <div class=\"audio__duration\">{{ formatTime(duration) }}</div>\n    </div>\n\n    <audio\n      ref=\"audio\"\n      autoplay=\"autoplay\"\n      class=\"audio-player__audio\"\n      :src=\"audioList[currentPlayIndex]\"\n      @ended=\"onEnded\"\n      @timeupdate=\"onTimeUpdate\"\n      @loadedmetadata=\"onLoadedmetadata\"\n      @playing=\"playing\"\n    ></audio>\n  </div>\n</template>\n\n<script>\nexport default {\n  name: \"AudioPlayer\",\n\n  props: {\n    // 音频播放列表\n    audioList: {\n      default: null,\n      type: Array\n    },\n    // 显示播放按钮\n    showPlayButton: {\n      default: true,\n      type: Boolean\n    },\n    // 显示上一首按钮\n    showPrevButton: {\n      default: true,\n      type: Boolean\n    },\n    // 显示下一首按钮\n    showNextButton: {\n      default: true,\n      type: Boolean\n    },\n    // 显示进度条\n    showProgressBar: {\n      default: true,\n      type: Boolean\n    },\n    // 播放前的回调函数\n    beforePlay: {\n      default: null,\n      type: Function\n    },\n    // 上一首前的回调函数\n    beforePrev: {\n      default: null,\n      type: Function\n    },\n    // 下一首前的回调函数\n    beforeNext: {\n      default: null,\n      type: Function\n    },\n    // 是否列表循环播放\n    isLoop: {\n      type: Boolean,\n      default: true\n    },\n    // 进度更新间隔\n    progressInterval: {\n      default: 1000,\n      type: Number\n    }\n  },\n\n  data() {\n    return {\n      isIOS: /iPhone|iPad|iPod/i.test(window.navigator.userAgent), // 是否是IOS设备\n      timer: null,\n      currentPlayIndex: 0, // 当前播放的音频位置索引\n      isPlaying: true, // 音频是否正在播放\n      duration: \"\", // 音频持续时间\n      currentTime: \"\", // 音频当前播放时间\n      currentTimeAfterFormat: \"\", // 音频播放当时时间（格式化后）\n      isDragging: false // 是否正在拖拽音频进度\n    };\n  },\n\n  methods: {\n    // 当媒介元素的持续时间以及其它媒介已加载数据时运行脚本\n    onLoadedmetadata(event) {\n      this.duration = this.$refs.audio.duration;\n      this.initProgressBarDrag();\n      this.$emit(\"loadedmetadata\", event);\n    },\n    // 当前的播放位置发送改变时触发\n    onTimeUpdate(event) {\n      this.$emit(\"timeupdate\", event);\n      if (this.$refs.audio.currentTime) {\n        this.currentTimeAfterFormat = this.formatTime(\n          this.$refs.audio.currentTime\n        );\n      }\n    },\n    // 格式化秒为分\n    formatTime(second) {\n      return [parseInt((second / 60) % 60), parseInt(second % 60)]\n        .join(\":\")\n        .replace(/\\b(\\d)\\b/g, \"0$1\");\n    },\n    // 音频播放完毕\n    onEnded(event) {\n      this.pause();\n      this.currentTimeAfterFormat = this.formatTime(\n        this.$refs.audio.currentTime\n      );\n      this.$emit(\"ended\", event);\n\n      if (this.isLoop) {\n        this.playNext();\n        this.play();\n      }\n    },\n    // 初始化音频进度的拖拽逻辑\n    initProgressBarDrag() {\n      this.$refs.audioProgressPoint.addEventListener(\n        \"touchstart\",\n        event => {\n          // 设置拖拽中\n          this.isDragging = true;\n        },\n        false\n      );\n      this.$refs.audioProgressPoint.addEventListener(\n        \"touchmove\",\n        event => {\n          let touch = event.touches[0];\n\n          // 超出左边\n          if (touch.pageX < this.$refs.audioProgressWrap.offsetLeft) {\n            // 设置点点\n            this.$refs.audioProgressPoint.style.left = 0;\n            // 设置进度条\n            this.$refs.audioProgress.style.width = 0;\n            // 设置当前时间\n            this.currentTime = 0;\n            // 设置当前时间（格式化后）\n            this.currentTimeAfterFormat = this.formatTime(this.currentTime);\n            return;\n          }\n\n          // 超出右边\n          if (\n            touch.pageX >\n            this.$refs.audioProgressWrap.offsetLeft +\n              this.$refs.audioProgressWrap.offsetWidth\n          ) {\n            // 设置点点\n            this.$refs.audioProgressPoint.style.left =\n              this.$refs.audioProgressWrap.offsetWidth -\n              this.$refs.audioProgressPoint.offsetWidth +\n              \"px\";\n            // 设置进度条\n            this.$refs.audioProgress.style.width =\n              this.$refs.audioProgressWrap.offsetWidth + \"px\";\n            // 设置当前时间，0.1解决有的浏览器播放完了进度还会再走\n            this.currentTime = this.duration - 0.1;\n            // 设置当前时间（格式化后）\n            this.currentTimeAfterFormat = this.formatTime(this.currentTime);\n            return;\n          }\n\n          this.setPointPosition(touch.pageX);\n          // 设置进度条\n          this.$refs.audioProgress.style.width =\n            touch.pageX - this.$refs.audioProgressWrap.offsetLeft + \"px\";\n          // 设置当前时间\n          this.currentTime =\n            (this.$refs.audioProgress.offsetWidth /\n              this.$refs.audioProgressWrap.offsetWidth) *\n            this.duration;\n          // 设置当前时间（格式化后）\n          this.currentTimeAfterFormat = this.formatTime(this.currentTime);\n        },\n        false\n      );\n      this.$refs.audioProgressPoint.addEventListener(\n        \"touchend\",\n        event => {\n          // 设置播放位置\n          this.$refs.audio.currentTime = this.currentTime;\n          // 设置未拖拽\n          this.isDragging = false;\n        },\n        false\n      );\n    },\n    // 设置点点位置\n    setPointPosition(pageX) {\n      // 设置点点\n      this.$refs.audioProgressPoint.style.left =\n        pageX -\n        this.$refs.audioProgressPoint.offsetWidth / 2 -\n        this.$refs.audioProgressWrap.offsetLeft +\n        \"px\";\n    },\n    // 初始化音频进度的点击逻辑\n    initProgressBarPoint(event) {\n      // 设置当前时间\n      this.currentTime =\n        ((event.pageX - this.$refs.audioProgressWrap.offsetLeft) /\n          this.$refs.audioProgressWrap.offsetWidth) *\n        this.duration;\n      // 设置播放位置\n      this.$refs.audio.currentTime = this.currentTime;\n      this.setPointPosition(event.pageX);\n      // 设置进度条\n      this.$refs.audioProgress.style.width =\n        event.pageX - this.$refs.audioProgressWrap.offsetLeft + \"px\";\n      // 设置当前时间（格式化后）\n      this.currentTimeAfterFormat = this.formatTime(this.currentTime);\n    },\n    // 播放中\n    playing() {\n      // 正在拖拽进度\n      if (this.isDragging) {\n        return;\n      }\n      // console.log(this.$refs.audio.currentTime)\n      // this.currentTimeAfterFormat = this.formatTime(\n      //   this.$refs.audio.currentTime\n\n      // )\n\n      // // 设置播放进度条\n      // this.$refs.audioProgress.style.width =\n      //   (this.$refs.audio.currentTime / this.$refs.audio.duration) *\n      //     this.$refs.audioProgressWrap.offsetWidth +\n      //   'px'\n      // // 设置播放进度拖拽点\n      // this.$refs.audioProgressPoint.style.left =\n      //   (this.$refs.audio.currentTime / this.$refs.audio.duration) *\n      //     (this.$refs.audioProgressWrap.offsetWidth -\n      //       this.$refs.audioProgressPoint.offsetWidth / 2) +\n      //   'px'\n      this.$emit(\"playing\");\n    },\n    // 开始播放\n    play() {\n      let playHandler = () => {\n        this.$refs.audio.play();\n        this.$nextTick(() => {\n          this.playing();\n          this.timer = window.setInterval(this.playing, this.progressInterval);\n          this.isPlaying = true;\n          this.$emit(\"play\");\n        });\n      };\n\n      // 解决 iOS 异步请求后无法播放\n      if (this.isIOS) {\n        this.$refs.audio.play();\n        this.$refs.audio.pause();\n      }\n\n      if (this.beforePlay) {\n        this.beforePlay(state => {\n          if (state !== false) {\n            playHandler();\n          }\n        });\n        return;\n      }\n\n      playHandler();\n    },\n    // 暂停播放\n    pause() {\n      this.$refs.audio.pause();\n      this.$nextTick(() => {\n        clearInterval(this.timer);\n        this.timer = null;\n        this.isPlaying = false;\n        this.$emit(\"pause\");\n      });\n    },\n    // 播放上一首\n    playPrev() {\n      if (this.currentPlayIndex <= 0 && !this.isLoop) {\n        // 无上一首了\n        return;\n      }\n\n      let prevHandler = () => {\n        if (this.currentPlayIndex <= 0 && this.isLoop) {\n          // 列表循环\n          this.currentPlayIndex = this.audioList.length - 1;\n        } else {\n          this.currentPlayIndex--;\n        }\n\n        this.$nextTick(() => {\n          this.play();\n          this.$emit(\"play-prev\");\n        });\n      };\n\n      if (this.beforePrev) {\n        this.beforePrev(state => {\n          if (state !== false) {\n            prevHandler();\n          }\n        });\n        return;\n      }\n      prevHandler();\n    },\n    // 播放下一首\n    playNext() {\n      if (this.currentPlayIndex + 1 >= this.audioList.length && !this.isLoop) {\n        // 无下一首了\n        return;\n      }\n\n      let nextHandler = () => {\n        // 已经到达列表最后一首\n        if (this.currentPlayIndex + 1 >= this.audioList.length && this.isLoop) {\n          this.currentPlayIndex = 0;\n        } else {\n          this.currentPlayIndex++;\n        }\n\n        this.$nextTick(() => {\n          this.play();\n          this.$emit(\"play-next\");\n        });\n      };\n\n      if (this.beforeNext) {\n        this.beforeNext(state => {\n          if (state !== false) {\n            nextHandler();\n          }\n        });\n        return;\n      }\n\n      nextHandler();\n    }\n  },\n\n  beforeDestroy() {\n    this.pause();\n  }\n};\n</script>\n\n<style>\n.audio-player {\n  margin: 0 15px;\n}\n\n.audio-player .audio__btn-wrap {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.audio-player .audio__btn-wrap .audio__play__icon {\n  width: 100%;\n  height: 100%;\n  fill: currentColor;\n  overflow: hidden;\n  color: #e35924;\n}\n\n.audio-player .audio__btn-wrap .audio__play--previous {\n  font-size: 33px;\n  width: 21px;\n  height: 33px;\n}\n\n.audio-player .audio__btn-wrap .audio__play--previous.disable {\n  opacity: 0.5;\n}\n\n.audio-player .audio__btn-wrap .audio__play--start {\n  font-size: 42px;\n  width: 42px;\n  height: 42px;\n  margin: 0 30px 0 40px;\n}\n\n.audio-player .audio__btn-wrap .audio__play--pause {\n  font-size: 42px;\n  width: 42px;\n  height: 42px;\n  margin: 0 30px 0 40px;\n}\n\n.audio-player .audio__btn-wrap .audio__play--next {\n  font-size: 33px;\n  width: 21px;\n  height: 33px;\n}\n\n.audio-player .audio__btn-wrap .audio__play--next.disable {\n  opacity: 0.5;\n}\n\n.audio-player .audio__progress-wrap {\n  position: relative;\n  background: #ddd;\n  height: 2px;\n  margin-top: 20px;\n}\n\n.audio-player .audio__progress-wrap .audio__progress {\n  position: absolute;\n  left: 0;\n  top: 0;\n  bottom: 0;\n  width: 0;\n  background: #e35924;\n}\n\n.audio-player .audio__progress-wrap .audio__progress-point {\n  position: absolute;\n  left: 0;\n  top: 50%;\n  width: 16px;\n  height: 16px;\n  border-radius: 50%;\n  margin-top: -8px;\n  background: #e35924;\n  box-shadow: 0 0 10px 1px rgba(227, 89, 36, 0.5);\n}\n\n.audio-player .audio__progress-wrap .audio__progress-point:after {\n  content: \"\";\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 8px;\n  height: 8px;\n  margin: -4px 0 0 -4px;\n  background: #fff;\n  border-radius: 50%;\n}\n\n.audio-player .audio__time-wrap {\n  display: flex;\n  flex-direction: row;\n  justify-content: space-between;\n  margin-top: 7px;\n}\n\n.audio-player .audio__time-wrap .audio__current-time {\n  font-size: 10px;\n  color: #888;\n}\n\n.audio-player .audio__time-wrap .audio__duration {\n  font-size: 10px;\n  color: #888;\n}\n\n.audio-player .audio-player__audio {\n  display: block;\n  margin: 0 auto;\n}\n</style>\n"]}]}